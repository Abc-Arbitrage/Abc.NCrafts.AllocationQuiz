<<<<<<< local
﻿using System;
using System.Configuration;
using Abc.NCrafts.App.ViewModels;
using Abc.NCrafts.App.ViewModels.Questions;
=======
﻿using Abc.NCrafts.App.ViewModels;
using Abc.NCrafts.App.ViewModels.Questions;
>>>>>>> other
using PropertyChanged;

namespace Abc.NCrafts.App
{
    [ImplementPropertyChanged]
    public class MainViewModel
    {
        public MainViewModel()
        {
<<<<<<< local
            Quiz = LoadQuiz();

=======
            var quiz = QuizLoader.LoadFrom(@"C:\Dev\dotnet\src\Spike\Abc.NCrafts.2015\Abc.NCrafts.Quizz\Questions");

>>>>>>> other
            var welcome = new WelcomePage(this);
            var register = new RegisterPage(this);
            var rules = new RulesPage(this);
            var game = new GamePage(this, quiz);
            var end = new EndPage(this);

            welcome.NextPage = register;
            register.PreviousPage = welcome;
            register.NextPage = rules;
            rules.PreviousPage = register;
            rules.NextPage = game;
            game.NextPage = end;
            end.NextPage = welcome;

            CurrentPage = welcome;
        }

        public Quiz Quiz { get; set; }
        public Player Player { get; set; }
        public ViewModel CurrentPage { get; set; }

        private static Quiz LoadQuiz()
        {
            var quizPath = ConfigurationManager.AppSettings["Quiz.Path." + Environment.MachineName.ToUpper()];
            if (string.IsNullOrEmpty(quizPath))
                quizPath = ConfigurationManager.AppSettings["Quiz.Path"];

            return QuizLoader.LoadFrom(quizPath);
        }

        public void UpdateAndSavePlayer()
        {
            if (Player == null)
                return;

            Player.Score = Quiz.CurrentQuestionIndex;
            Player.Save();
        }
    }
}
